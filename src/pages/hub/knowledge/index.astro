---
import HubLayout from '../../../layouts/HubLayout.astro';
import { getCollection } from 'astro:content';

const allKnowledge = await getCollection('knowledge');

// Group by category
const categories = {
  electronics: [],
  cs: [],
  english: [],
  embedded: []
};

allKnowledge.forEach(k => {
  if (categories[k.data.category]) {
    categories[k.data.category].push(k);
  }
});
---

<HubLayout title="Knowledge Graph">
  <div class="tools-bar">
    <a href="/hub/knowledge/new" class="text-mono text-small">[+ 새 개념 추가]</a>
  </div>

  <div class="knowledge-index">
    {Object.entries(categories).map(([category, items]) => (
      <section class="category-block">
        <h3 class="category-header">{category.toUpperCase()}</h3>
        <ul class="concept-list">
          {items.map(item => (
            <li>
              <a href={`/hub/knowledge/${item.slug}`}>{item.data.title}</a>
            </li>
          ))}
          {items.length === 0 && <li class="empty text-muted">항목 없음.</li>}
        </ul>
      </section>
    ))}
  </div>
</HubLayout>

<style>
  .tools-bar { 
    text-align: right; 
    margin-bottom: 2rem; 
    border-bottom: 1px dotted var(--c-border);
    padding-bottom: 0.5rem;
  }

  .knowledge-index {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
    gap: 3rem;
  }

  .category-header {
    font-size: 1rem;
    color: var(--c-ink-light);
    border-bottom: 1px solid var(--c-navy);
    padding-bottom: 0.5rem;
    margin-bottom: 1rem;
  }

  .concept-list {
    list-style: none;
    padding: 0;
  }
  .concept-list li {
    margin-bottom: 0.5rem;
    font-family: var(--font-body);
  }
  .concept-list a {
    color: var(--c-blue);
  }
  .empty { font-style: italic; font-size: 0.9rem; }
</style>
